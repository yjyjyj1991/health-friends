<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.healthfriend.healthfriend.model.mapper.UserMapper">

	<insert id="insertUser" parameterType="UserDto">
		INSERT INTO tbl_user(purpose_id, email, name, nickname, password, isWithdraw,weight,active_point )
		VALUES ( #{purposeId}, #{email}, #{name}, #{nickname}, #{password}, #{isWithdraw}, #{weight}, #{activePoint} );
	</insert>

    <update id="updateUser" parameterType="UserDto">
        <!-- <selectKey resultType="int" keyProperty="id" order="BEFORE">
            SELECT id FROM tbl_user WHERE email = #{email}      
        </selectKey>     -->
			UPDATE tbl_user
			SET nickname = #{nickname}, password = #{password} , active_point = #{activePoint}
			WHERE id = #{id};
    </update>

    <update id="deleteUser" parameterType="UserDto">
		UPDATE tbl_user
		SET isWithdraw = 1, withdraw_reason = #{withdrawReason}
		WHERE id = #{id};
    </update>

		<update id="updateUserPassword" parameterType="UserDto">
			UPDATE tbl_user
			SET password = #{password}
			WHERE isWithdraw = 0 AND email = #{email};
		</update>

		<select id="isExistsEmail" parameterType="string" resultType="boolean">
			SELECT COUNT(*)
			FROM tbl_user
			WHERE email = #{email} AND isWithdraw = 0
		</select>

		<select id="isExistsNickname" parameterType="string" resultType="boolean">
			SELECT COUNT(*)
			FROM tbl_user
			WHERE nickname = #{nickname} AND isWithdraw = 0
		</select>


		<update id="updateDUser" parameterType="userDto">
			UPDATE tbl_user
			SET isWithdraw = 1, withdraw_reason = #{withdrawReason}
			WHERE id = #{id};
		</update>

		<select id="selectUser" parameterType="userDto" resultType="userDto">
			SELECT name, email, nickname, purpose_id, active_point, weight
			FROM tbl_user
			WHERE email = #{email} and password = #{password}
		</select>

		<select id="selectUserInfo" parameterType="String" resultType="userDto">
			SELECT name, email, password, id, nickname, weight , active_point
			FROM tbl_user
			WHERE email = #{email}
		</select>

</mapper>